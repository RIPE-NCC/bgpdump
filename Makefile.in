# $Id$

CC	= @CC@
CFLAGS	= @CFLAGS@
COMPILE  = $(CC) $(CFLAGS) $(INCLUDES)

LD	= @CC@
LDFLAGS	= @LDFLAGS@
AR	= @AR@
RANLIB	= @RANLIB@

SYS_LIBS= @LIBS@

LIB_H	 = bgpdump.h bgpdump_attr.h bgpdump_formats.h bgpdump_lib.h bgpdump_mstream.h cfile_tools.h util.h
LIB_O	 = bgpdump_lib.o bgpdump_mstream.o cfile_tools.o util.o inet_ntop.o

all: libbgpdump.so bgpdump 

libbgpdump.a: $(LIB_H) $(LIB_O) Makefile
	$(AR) r libbgpdump.a $(LIB_O)
	$(RANLIB) libbgpdump.a

libbgpdump.so: libbgpdump.a
	$(COMPILE) $(LDFLAGS) -o libbgpdump.so libbgpdump.a $(SYS_LIBS)

testbgpdump: test.c libbgpdump.a
	$(COMPILE) -o testbgpdump test.c libbgpdump.a $(SYS_LIBS)

bgpdump: bgpdump.c libbgpdump.a
	$(COMPILE) -o bgpdump bgpdump.c libbgpdump.a $(SYS_LIBS)

test-clean:
	rm -f test_out/*.bgp.gz

test: test-clean bgpdump
	./test.sh

clean: test-clean
	rm -f libbgpdump.so libbgpdump.a testbgpdump bgpdump $(LIB_O)

distclean: clean
	rm -rf config.log config.status *.dSYM core *.core autom4te.cache bgpdump-config.h Makefile
